<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Performance and optimization • openalexR</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Performance and optimization">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">openalexR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/A_Brief_Introduction_to_openalexR.html">A Brief Introduction to openalexR</a></li>
    <li><a class="dropdown-item" href="../articles/About-the-tibble-output.html">About the tibble output</a></li>
    <li><a class="dropdown-item" href="../articles/Filters.html">Filters</a></li>
    <li><a class="dropdown-item" href="../articles/institution.html">Transition towards Open Access</a></li>
    <li><a class="dropdown-item" href="../articles/literature-search.html">Literature search</a></li>
    <li><a class="dropdown-item" href="../articles/performance-optimization.html">Performance and optimization</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/openalexR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Performance and optimization</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/openalexR/blob/master/vignettes/articles/performance-optimization.Rmd" class="external-link"><code>vignettes/articles/performance-optimization.Rmd</code></a></small>
      <div class="d-none name"><code>performance-optimization.Rmd</code></div>
    </div>

    
    
<p>While <code><a href="../reference/oa_fetch.html">oa_fetch()</a></code> offers a convenient and flexible way of
retrieving results from queries to the OpenAlex API, its defaults may
not be best suited for heavier workflows that involve fetching records
in the magnitude of tens or hundreds of thousands of entities.</p>
<p>Optimizing the performance of such large queries benefits greatly
from being intentional and specific about what kinds of information you
care about, and making assumptions that let you safely take shortcuts
around the defaults.</p>
<p>This vignette discusses three strategies for for optimizing
performance of large queries:</p>
<ul>
<li>The parameter <code>options = list(select = ...)</code> in
<code><a href="../reference/oa_fetch.html">oa_fetch()</a></code>
</li>
<li>The argument <code>output = "list"</code> in
<code><a href="../reference/oa_fetch.html">oa_fetch()</a></code>
</li>
<li>The function <code><a href="../reference/oa_generate.html">oa_generate()</a></code>
</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/openalexR">openalexR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="the-select-strategy">The <code>select</code> strategy<a class="anchor" aria-label="anchor" href="#the-select-strategy"></a>
</h2>
<p>The <code>options</code> argument of <code><a href="../reference/oa_fetch.html">oa_fetch()</a></code>
specifies a list of additional parameters to add to the query, such as
<code>select</code>, <code>sort</code>, <code>sample</code>, and
<code>seed</code>. Of these, <code>select</code> can be used to specify
which fields of the entities are to be returned by OpenAlex. By
specifying only the kinds of information about entities that you care
about, you can reduce the overall size of the query result, which will
in turn speed up the fetching of the raw JSON and its conversion to a
data frame.</p>
<p>For example, suppose that we are looking for a sample of works from
the <a href="https://docs.openalex.org/api-entities/topics" class="external-link">Topic</a> of
<a href="https://openalex.org/topics/T10730" class="external-link">Language Development and
Acquisition in Children</a> (<code>"T10730"</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">language_development</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oa_fetch.html">oa_fetch</a></span><span class="op">(</span></span>
<span>  entity <span class="op">=</span> <span class="st">"topics"</span>,</span>
<span>  search <span class="op">=</span> <span class="st">"Language Development and Acquisition in Children"</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">language_development</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 2</span></span></span>
<span><span class="co">#&gt;   id                          display_name                                    </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> https://openalex.org/T10730 Language Development and Acquisition in Children</span></span></code></pre></div>
<p>To sample some papers from this topic, we can use the
<code>topics.id</code> <a href="https://docs.ropensci.org/openalexR/articles/Filters.html">filter</a>
and set <code>options = list(sample = 5, seed = 1)</code> to return a
random set of five <a href="https://docs.openalex.org/api-entities/works" class="external-link">Works</a> entities
with a reproducible seed:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/oa_fetch.html">oa_fetch</a></span><span class="op">(</span></span>
<span>  entity <span class="op">=</span> <span class="st">"works"</span>,</span>
<span>  topics.id <span class="op">=</span> <span class="va">language_development</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/show_works.html">show_works</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 8</span></span></span>
<span><span class="co">#&gt;   id        display_name first_author last_author so    url   is_oa top_concepts</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> W4401916… The effect … Melissa K. … Yujin Song  Lang… http… TRUE  Referent, P…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> W4319601… The Effect … Ziyu Yang    <span style="color: #BB0000;">NA</span>          Jour… http… TRUE  Foreign lan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> W2166086… Differentia… Julie Demouy Laurence R… Rese… http… FALSE Specific la…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> W4364379… Chapter 4. … Mark Amengu… <span style="color: #BB0000;">NA</span>          Bili… http… FALSE Phonology, …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> W2894907… The acquisi… Kayla Raye … <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>    http… FALSE Relative cl…</span></span></code></pre></div>
<p>In OpenAlex, entities have a set of <strong>fields</strong> which
represent various information about them. These are typically returned
as data frame columns by <code><a href="../reference/oa_fetch.html">oa_fetch()</a></code>, and the full list of
fields can be found in the API documentation for each entity. For
example, <a href="https://docs.openalex.org/api-entities/works/work-object" class="external-link">the
fields in a Works object</a> contain information such as
<code>id</code>, <code>display_name</code>, <code>authorships</code>,
and so on.</p>
<p>If we only cared about the above three fields from our sample of
papers, we can simplify specify those fields in the <code>select</code>
parameters of the <code>options</code> list of arguments:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/oa_fetch.html">oa_fetch</a></span><span class="op">(</span></span>
<span>  entity <span class="op">=</span> <span class="st">"works"</span>,</span>
<span>  topics.id <span class="op">=</span> <span class="va">language_development</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                 select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"display_name"</span>, <span class="st">"authorships"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 3</span></span></span>
<span><span class="co">#&gt;   id                               display_name                           author</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> https://openalex.org/W4401916583 The effect of emotional prosody and r… <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> https://openalex.org/W4319601311 The Effect of Learning a Second Forei… <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> https://openalex.org/W2166086935 Differential language markers of path… <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> https://openalex.org/W4364379308 Chapter 4. Cross-language influences … <span style="color: #949494;">&lt;df&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> https://openalex.org/W2894907948 The acquisition of relative clause st… <span style="color: #949494;">&lt;df&gt;</span></span></span></code></pre></div>
<p>This returns the scalar fields <code>id</code> and
<code>display_name</code> in their appropriate data types (character) in
the dataframe. Additionally, the <code>authorships</code> field has been
further processed as a list-column of data frames, to fit nicely into
the “tidy” data frame structure.</p>
<p>Specifying the desired fields up front in this way is not only
convenient but also more performant, as there will be less data for
<code><a href="../reference/oa_fetch.html">oa_fetch()</a></code> to process.</p>
</div>
<div class="section level2">
<h2 id="the-output-list-strategy">The <code>output = "list"</code> strategy<a class="anchor" aria-label="anchor" href="#the-output-list-strategy"></a>
</h2>
<p>By default, <code><a href="../reference/oa_fetch.html">oa_fetch()</a></code> uses
<code>output = "tibble"</code>, which returns a processed
<code>tibble</code> data frame of the results. In such cases, the JSON
response from OpenAlex is first converted to an R list, then a data
frame via <code><a href="../reference/oa2df.html">oa2df()</a></code>, which calls the appropriate conversion
implementation depending on the type of entity being processed (e.g.,
<code><a href="../reference/works2df.html">works2df()</a></code> for Works entities).</p>
<p>A lot of care goes into <code><a href="../reference/oa2df.html">oa2df()</a></code> to return a compact,
tidy-data representation of query results. But these operations can
become a bottleneck to performance at scale, and so sometimes you may
want to opt out of this automatic data frame conversion.</p>
<p>To do so in <code><a href="../reference/oa_fetch.html">oa_fetch()</a></code>, you can set
<code>output = "list"</code>, which will simply return the R list
corresponding to the JSON response.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oa_fetch.html">oa_fetch</a></span><span class="op">(</span></span>
<span>  entity <span class="op">=</span> <span class="st">"works"</span>,</span>
<span>  topics.id <span class="op">=</span> <span class="va">language_development</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"list"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">output_list</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ :List of 50</span></span>
<span><span class="co">#&gt;  $ :List of 50</span></span>
<span><span class="co">#&gt;  $ :List of 51</span></span>
<span><span class="co">#&gt;  $ :List of 50</span></span>
<span><span class="co">#&gt;  $ :List of 50</span></span></code></pre></div>
<p>The list output can get quite unruly — each record contains dozens of
fields, some of which may be multiply nested. Moreover, some records may
have missing or incomplete fields, so extra care must be taken with the
<code>output = "list"</code> approach.</p>
<p>One advantage of returning the output as a list is that you can
always come back to process them as data frames later. Instead of
retrieving <em>and</em> converting the results simultaneously, which may
stress <code><a href="../reference/oa_fetch.html">oa_fetch()</a></code> for large queries, you can retrieve all
the results first <em>and then</em> convert them after the fact.</p>
<p>In our case, the Works entities can be processed with
<code><a href="../reference/works2df.html">works2df()</a></code> (or more generally,
<code>oa2df(entity = "works")</code>), which returns a data frame
identical to what we saw at the start with the default
<code>output = "tibble"</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/works2df.html">works2df</a></span><span class="op">(</span><span class="va">output_list</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/show_works.html">show_works</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 8</span></span></span>
<span><span class="co">#&gt;   id        display_name first_author last_author so    url   is_oa top_concepts</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> W4401916… The effect … Melissa K. … Yujin Song  Lang… http… TRUE  Referent, P…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> W4319601… The Effect … Ziyu Yang    <span style="color: #BB0000;">NA</span>          Jour… http… TRUE  Foreign lan…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> W2166086… Differentia… Julie Demouy Laurence R… Rese… http… FALSE Specific la…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> W4364379… Chapter 4. … Mark Amengu… <span style="color: #BB0000;">NA</span>          Bili… http… FALSE Phonology, …</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> W2894907… The acquisi… Kayla Raye … <span style="color: #BB0000;">NA</span>          <span style="color: #BB0000;">NA</span>    http… FALSE Relative cl…</span></span></code></pre></div>
<p>Additionally, opting out of the data frame conversion also means that
you can use your own preferred implementation for converting the list
output. This can be a very powerful optimization strategy when combined
with the <code>select</code> option.</p>
<p>For example, if you know that you are only selecting scalar fields,
you can very quickly convert the list output into a tidy data using more
powerful tools like <code>data.table::rbindlist()</code> or even just
<code><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/oa_fetch.html">oa_fetch</a></span><span class="op">(</span></span>
<span>  entity <span class="op">=</span> <span class="st">"works"</span>,</span>
<span>  topics.id <span class="op">=</span> <span class="va">language_development</span><span class="op">$</span><span class="va">id</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                 select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"display_name"</span>, <span class="st">"cited_by_count"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"list"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind.data.frame</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 3</span></span></span>
<span><span class="co">#&gt;   id                               display_name                   cited_by_count</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> https://openalex.org/W4401916583 The effect of emotional proso…              0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> https://openalex.org/W4319601311 The Effect of Learning a Seco…              0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> https://openalex.org/W2166086935 Differential language markers…             58</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> https://openalex.org/W4364379308 Chapter 4. Cross-language inf…              2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> https://openalex.org/W2894907948 The acquisition of relative c…              0</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-oa_generate-strategy">The <code>oa_generate()</code> strategy<a class="anchor" aria-label="anchor" href="#the-oa_generate-strategy"></a>
</h2>
<p>If your code still seems slow, it is possible that you may have run
out of memory (especially when you do a snowball search like with
<code>oa_snowball</code>). In such cases, it might help to chunk your
work and save the output of each step, then piece them back together
later in a different session/program.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Determining whether memory is sufficient to store all
records at the beginning is not straightforward. We believe the (power)
user should be in charge of this step, combining `count_only = TRUE`
with their knowledge of their machine’s RAM specs to determine whether
they should write out the stepwise results themselves. Related GH
issues: &lt;a href="https://github.com/ropensci/openalexR/issues/129#issuecomment-1642664363" class="external-link"&gt;here&lt;/a&gt;
and &lt;a href="https://github.com/ropensci/openalexR/issues/95#issuecomment-1513964112" class="external-link"&gt;here&lt;/a&gt;.&lt;/p&gt;'><sup>1</sup></a></p>
<p>The <code><a href="../reference/oa_generate.html">oa_generate()</a></code> function is a lower-level function
that allows you to process one record at a time. This way, you can
process records in batches of, say, 1000 records, and write them out to
disk as you go along.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Quick note: For the case without &lt;code&gt;group_by&lt;/code&gt;,
setting &lt;code&gt;verbose = TRUE&lt;/code&gt; when you call &lt;code&gt;oar()&lt;/code&gt; for
the first time will give the total number of records in the message.
With &lt;code&gt;group_by&lt;/code&gt;, unfortunately we don’t have a way to know
the total until we query until exhausted. Also, you will need to have
the R package &lt;a href="https://github.com/r-lib/coro" class="external-link"&gt;&lt;strong&gt;coro&lt;/strong&gt;&lt;/a&gt; installed
to use &lt;code&gt;&lt;a href="../reference/oa_generate.html"&gt;oa_generate()&lt;/a&gt;&lt;/code&gt;
(&lt;code&gt;install.packages("coro")&lt;/code&gt;).&lt;/p&gt;'><sup>2</sup></a></p>
<p>In the example below, we show how <code><a href="../reference/oa_generate.html">oa_generate()</a></code> works
when we want to find all the works that cite <a href="https://openalex.org/works/W1160808132" class="external-link">W1160808132</a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">query_url</span> <span class="op">&lt;-</span> <span class="st">"https://api.openalex.org/works?filter=cites%3AW1160808132"</span></span>
<span><span class="va">oar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oa_generate.html">oa_generate</a></span><span class="op">(</span><span class="va">query_url</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">oar</span><span class="op">(</span><span class="op">)</span> <span class="co"># record 1</span></span>
<span><span class="co">#&gt; Getting record 1 of 483 records...</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">oar</span><span class="op">(</span><span class="op">)</span> <span class="co"># record 2</span></span>
<span><span class="co">#&gt; Getting record 2 of 483 records...</span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">oar</span><span class="op">(</span><span class="op">)</span> <span class="co"># record 3</span></span>
<span><span class="co">#&gt; Getting record 3 of 483 records...</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span>
<span><span class="co">#&gt; $id</span></span>
<span><span class="co">#&gt; [1] "https://openalex.org/W2766937672"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $doi</span></span>
<span><span class="co">#&gt; [1] "https://doi.org/10.1016/j.enpol.2017.10.050"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $title</span></span>
<span><span class="co">#&gt; [1] "How economic growth, renewable electricity and natural resources contribute to CO2 emissions?"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $display_name</span></span>
<span><span class="co">#&gt; [1] "How economic growth, renewable electricity and natural resources contribute to CO2 emissions?"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $publication_year</span></span>
<span><span class="co">#&gt; [1] 2017</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $publication_date</span></span>
<span><span class="co">#&gt; [1] "2017-11-22"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p3</span><span class="op">)</span></span>
<span><span class="co">#&gt; $id</span></span>
<span><span class="co">#&gt; [1] "https://openalex.org/W2317269391"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $doi</span></span>
<span><span class="co">#&gt; [1] "https://doi.org/10.1016/j.renene.2016.03.078"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $title</span></span>
<span><span class="co">#&gt; [1] "Determinants of CO2 emissions in the European Union: The role of renewable and non-renewable energy"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $display_name</span></span>
<span><span class="co">#&gt; [1] "Determinants of CO2 emissions in the European Union: The role of renewable and non-renewable energy"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $publication_year</span></span>
<span><span class="co">#&gt; [1] 2016</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $publication_date</span></span>
<span><span class="co">#&gt; [1] "2016-04-01"</span></span></code></pre></div>
<p>As you see, each record returned by <code>oa_generate</code> is a
list of fields belonging to a work, parsed from the JSON response from
OpenAlex. You can process these records as you see fit, such as writing
them out as <em>.rds</em> files in batches of 100 records.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">query_url</span> <span class="op">&lt;-</span> <span class="st">"https://api.openalex.org/works?filter=cites%3AW1160808132"</span></span>
<span><span class="va">oar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oa_generate.html">oa_generate</a></span><span class="op">(</span><span class="va">query_url</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">recs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="fu">coro</span><span class="fu">::</span><span class="fu"><a href="https://coro.r-lib.org/reference/collect.html" class="external-link">loop</a></span><span class="op">(</span><span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="va">oar</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">j</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">recs</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">j</span> <span class="op">==</span> <span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">recs</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"rec-%s.rds"</span>, <span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="va">n</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">recs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="va">n</span><span class="op">)</span> <span class="co"># reset recs</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"rec-\\d.rds$"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "rec-0.rds" "rec-1.rds" "rec-2.rds" "rec-3.rds"</span></span></code></pre></div>
<div class="section level3">
<h3 id="tips-on-generating-the-query-url-to-the-openalex-api">Tips on generating the query URL to the OpenAlex API<a class="anchor" aria-label="anchor" href="#tips-on-generating-the-query-url-to-the-openalex-api"></a>
</h3>
<p>To build your query, you can use <code><a href="../reference/oa_query.html">oa_query()</a></code> and
carefully read the <a href="https://docs.openalex.org/" class="external-link">API
documentation</a> to see what fields/filters are available. For example,
I know <code>cites</code> is a filter we can use:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/oa_query.html">oa_query</a></span><span class="op">(</span>entity <span class="op">=</span> <span class="st">"works"</span>, cites <span class="op">=</span> <span class="st">"W1160808132"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "https://api.openalex.org/works?filter=cites%3AW1160808132"</span></span></code></pre></div>
<p>However, you might find it helpful to use the OpenAlex web interface
to build the query <a href="https://openalex.org/works?page=1&amp;filter=authorships.author.id%3Aa5086928770,open_access.is_oa%3Atrue&amp;view=list,report,api" class="external-link">interactively</a>.
Make sure you select the Gear icon on the right and toggle on “Api
query”.</p>
<div class="float">
<img src="images/openalex-web.png" alt="Screenshot of OpenAlex web interface for generating API query URLs"><div class="figcaption">Screenshot of OpenAlex web interface for
generating API query URLs</div>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
